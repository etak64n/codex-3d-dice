# 3D サイコロ（Three.js + Rapier）

このプロジェクトは、Three.js と Rapier で動作する 3D サイコロ・デモです。PBR 表現のダイス、物理ベースのロール挙動、カジノ風のテーブルと背景（ボケ演出）を備えています。UI は排除し、キャンバス全画面でシンプルに遊べる構成です。

本プロジェクトは全て CODEX（Codex CLI）を用いて自動生成しました。

## 特徴
- Three.js による PBR ルックの 6 面ダイス（丸角ボックス＋ステッカー）
- Rapier 物理（床・壁・天井＋木枠レール）で自然な転がりと停止判定
- カジノ風フェルト／木目ベース／レザー調レール／金縁の簡易マテリアル
- 明るい暖色系のボケ背景（CanvasTexture で生成）
- クリック/タップ（pointerdown）でいつでも振り直し可能（動作中も可）

## 動作環境
- Node.js 18 以上（Vite 5 系を使用）
- 推奨ブラウザ: 最新の Chrome / Edge / Safari

## セットアップ
```bash
# 依存関係のインストール
npm install
```

## 実行（開発）
```bash
npm run dev
```
- Vite の開発サーバーが起動します（既定では http://localhost:5173 ）。
- ファイル保存でホットリロードされます。

## ビルド（本番）
```bash
npm run build   # dist/ に出力
npm run preview # 本番ビルドの簡易サーバーで確認
```
- 生成された `dist/` フォルダを任意の静的ホスティングに配置してください。

## 操作方法
- クリック/タップ（キャンバス内）: サイコロを振る（ロール中でも即時振り直し）
- スペースキー: サイコロを振る

## 主なファイル
- `index.html` : 全画面キャンバスとエントリーポイント
- `src/main.ts` : シーン構築、物理、入力、描画ループ、見た目の定義一式

## 実装メモ（調整ポイント）
- 物理（落下・勢い）
  - 重力: `new RAPIER.World({ y: -16.0 })`
  - 開始高さ: `PHYS.startY = 3.0`
  - ロール中でも振り直し可能（`pointerdown` で入力、カウンタをリセット）
  - 固定タイムステップ（`PHYS.worldHz`）に合わせ、サブステップで実時間に追従
- 画面外への逸脱対策
  - 可視レール（木枠）をコライダーとして追加（フェルト周囲）
  - ソフト境界 `BOUNDS` で外へ出そうな場合に穏やかに内側へインパルス
- 見た目（マテリアル／背景）
  - ダイス本体: `MeshPhysicalMaterial` に粗さ・クリアコートを設定、微ラフネス/バンプで白飛びを抑制
  - ステッカー: 透明背景のテクスチャ（点のみ描画）でボディ色に馴染むよう調整
  - フェルト・木目・レザー: `CanvasTexture` で簡易生成（色味や粗さはコード内の定数で調整可）
  - 背景: 明るい暖色グラデ＋ボケ円（ビネットは無効化）
- 明るさ（白飛び対策）
  - 露出: `renderer.toneMappingExposure` を適宜調整（例: 1.35〜1.50）
  - 強いハイライトが気になる場合は、各 `MeshPhysicalMaterial` の `roughness` を上げ、`clearcoat`/`envMapIntensity`/`specularIntensity` をやや下げると落ち着きます。

## ライセンス
- 本リポジトリ内コードはプロジェクト目的で自由に利用可能です（サードパーティ依存は各ライセンスに従います）。
